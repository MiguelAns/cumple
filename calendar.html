<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendario con Guardias</title>
  <link rel="stylesheet" href="styles.css">
  <script defer src="calendar.js"></script>
  <script defer src="login.js"></script>
</head>
<body class="fondo">
<!-- Barra de navegaciÃ³n -->
<nav id="sidebar" class="sidebar">
  <button id="toggle-menu" class="menu-button">â˜°</button>
  <ul>
    <li><a href="index.html">ğŸ  Inicio</a></li>
    <li><a href="guards.html">ğŸ›¡ï¸ Guardias</a></li>
    <li><a href="uniforms.html">ğŸ‘” Uniformes</a></li>
    <li><a href="login.html" id="logout-button">Cerrar SesiÃ³n</a></li>
  </ul>
</nav>

<div class="container">
  <!-- Canvas para los fuegos artificiales -->
  <canvas id="fireworks"></canvas>

  <div class="calendar-container">
    <h1>ğŸ“… Calendario</h1>
    <div class="navigation">
      <button id="prev-month">Previous</button>
      <span id="month-label"></span>
      <button id="next-month">Next</button>
    </div>
    <div id="calendar"></div>
    <button onclick="window.history.back()">Back</button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Verificar sesiÃ³n
    try {
      const response = await fetch('http://localhost:3000/session', {
        method: 'GET',
        credentials: 'include',
      });

      if (!response.ok) {
        window.location.href = 'login.html'; // Redirige si no estÃ¡ autenticado
        return;
      }

      const userData = await response.json();

      if (userData.role === 'admin') {
        console.log('Acceso como administrador');
      } else if (userData.role === 'user') {
        console.log('Acceso como usuario');
      } else {
        alert('Acceso denegado');
        window.location.href = 'login.html';
      }
    } catch (error) {
      console.error('Error al verificar la sesiÃ³n:', error);
      window.location.href = 'login.html';
    }

    // Manejo de la barra lateral
    const sidebar = document.getElementById('sidebar');
    const toggleMenuButton = document.getElementById('toggle-menu');

    // Verificar que el botÃ³n y la barra existan
    if (toggleMenuButton && sidebar) {
      toggleMenuButton.addEventListener('click', () => {
        sidebar.classList.toggle('hidden'); // Mostrar/Ocultar la barra lateral
      });
    } else {
      console.error('No se encontraron los elementos #sidebar o #toggle-menu');
    }

    // Cerrar sesiÃ³n
    const logoutButton = document.getElementById('logout-button');
    if (logoutButton) {
      logoutButton.addEventListener('click', async () => {
        try {
          const response = await fetch('http://localhost:3000/logout', {
            method: 'POST',
            credentials: 'include',
          });

          if (response.ok) {
            window.location.href = 'login.html';
          }
        } catch (error) {
          console.error('Error al cerrar sesiÃ³n:', error);
        }
      });
    }
  });
</script>
</body>
</html>
